---
name: postbank
encoding: cp1252
type: csv

lines:
- type: match
  pattern: "Umsatzauskunft;"
- type: match
  pattern: "Name;(?P<account_owner>.*);"
- type: match
  pattern: "BLZ;(?P<bank_national_id>.*);"
- type: match
  pattern: "Kontonummer;(?P<account_national_id>.*);"
- type: match
  pattern: "IBAN;(?P<account_id>.*);"
- type: match
  pattern: "Aktueller Kontostand;(?P<current_balance_value>.*) (?P<account_currency>.);"
- type: match
  pattern: "Summe der Umsätze in den nächsten 14 Tagen;(.*) (.);"
- type: match
  pattern: "Umsätze in den nächsten 14 Tagen;"
- type: csv
#Buchungsdatum;Umsatzart;Buchungsdetails;Auftraggeber;Empfänger;Betrag (€);
#10.09.2021;Lastbuchung;Bezahlfunktion10.09.2021;Eric Lavarde;;-323,94 €;
  dialect:
    delimiter: ";"
    doublequote: false
    escapechar: null  # None
    lineterminator: "\n"
    quotechar: '"'
    quoting: 3  # 0=minimal, 1=all, 2=nonnumeric, 3=none
    skipinitialspace: true
    strict: true
  reverse: true  # entries are sorted older dates last
  skip: true
- type: match
  pattern: "gebuchte Umsätze;"
- type: csv
  dialect:
    delimiter: ";"
    doublequote: false
    escapechar: null  # None
    lineterminator: "\n"
    quotechar: '"'
    quoting: 3  # 0=minimal, 1=all, 2=nonnumeric, 3=none
    skipinitialspace: true
    strict: true
  reverse: true  # entries are sorted older dates last
  map:
  - key: Buchungsdatum
    pattern: "(?P<transaction_booking_date>.*)"
  - key: Wertstellung
    pattern: "(?P<transaction_value_date>.*)"
  - key: Umsatzart
    pattern: "(?P<transaction_type>.*)"
  - key: Auftraggeber
    pattern: "(?P<transaction_originator_name>.*)"
  - key: Empfänger
    pattern: "(?P<transaction_receiver_name>V PAY)"
    then:
    - key: Buchungsdetails
      pattern: "Referenz (?P<transaction_reference>.*)Mandat (?P<transaction_mandate>.*)Einreicher-ID (?P<transaction_presenter_id>.{18})(?P<transaction_presenter_name>.*)//(?P<transaction_city>.*)/(?P<transaction_country_code>..)(?P<transaction_details>.*)"
    else:
    - key: Buchungsdetails
      pattern:
      - "Referenz (?P<transaction_reference>.*)Mandat (?P<transaction_mandate>.*)Einreicher-ID (?P<transaction_presenter_id>.{18})(?P<transaction_presenter_name>.*)(?P<transaction_city>.*)/(?P<transaction_country_code>..)(?P<transaction_details>.*)"
      - "Referenz (?P<transaction_reference>.*)Mandat (?P<transaction_mandate>.*)Einreicher-ID (?P<transaction_presenter_id>.{18})(?P<transaction_presenter_name>.*) (?P<transaction_details>.*)"
      - "(?P<transaction_details>.*)"
    - key: Empfänger
      pattern: "(?P<transaction_receiver_name>.*)"
  - key: Betrag (€)
    pattern: "(?P<transaction_value>.*) (?P<transaction_currency>.)"
  - key: Saldo (€)
    pattern: "(?P<transaction_balance_value>.*) (?P<transaction_balance_currency>.)"
#10.09.2021;10.09.2021;Kartenzahlung;Referenz VZ2109100057090809Mandat 160900Einreicher-ID DE37SCC00000040819CARREFOUR DAC VL//ILLZACH/FR2021-09-08T14:55:22Folgenr. 002 Verfalld. 2412;Eric Lavarde;V PAY;-25,40 €;16.312,50 €;
...
